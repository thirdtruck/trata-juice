fs = require 'fs'

monthSummaries = [
	'Jan',
	'Feb',
	'Mar',
	'Apr',
	'May',
	'Jun',
	'Jul',
	'Aug',
	'Sep',
	'Oct',
	'Nov',
	'Dec'
]

Pomodoro = () ->
	length: 25
	completed: false
	interruptions: 0
	toString: () ->
		completed = if this.completed then 'x' else ' '
		interruptions = if this.interruptions > 0 then '+' + this.interruptions else ''
		'[' + completed + ']' + interruptions

PomodoroCan = (date, pomodoros) ->
	pomodoros: pomodoros || [ ]
	date: date || new Date
	toString: () ->
		dateString = [this.date.getDate(),
			monthSummaries[this.date.getMonth()],
			this.date.getFullYear()].join '-' 
		pomodoroParts = for index in [0..this.pomodoros.length-1]
			pomodoro = this.pomodoros[index]
			if (index + 1) % 4 == 0 && index < this.pomodoros.length - 1
				pomodoro.toString() + ' |'
			else
				pomodoro.toString()
		dateString + "\n" + pomodoroParts.join ' '

Trata = (startDate) ->
	file: 'pomodoro.txt'
	can: new PomodoroCan((new Date), (new Pomodoro for num in [1..8]))
	init: (onFinish) ->
		fs.writeFile this.file, this.can.toString(), (err) ->
			if err
				console.log err
				exit

			onFinish()

module.exports = new Trata
